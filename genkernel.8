.TH GENKERNEL "8" "February 2006" "genkernel 4.0" "Gentoo Linux"
.SH NAME
genkernel \- the Gentoo Linux automatic kernel compiler and initramfs
generation tool.
.SH SYNOPSIS
genkernel [options/modules]+
.SH INTRODUCTION
Genkernel is designed to allow users who are not previously used to
compiling a kernel to use a similar setup to that one that is used on
the Gentoo LiveCDs which auto-detects your hardware.
.PP
Some users may also be interested in using genkernel for hardware
which requires initialization and a working kernel before it can be
booted because genkernel also automatically compiles your kernel
modules, allowing hardware which needs to be loaded with module
parameters to be used.
.PP
Note that since genkernel 4.0 builds initramfs based images; a
Linux kernel of 2.6 or newer is required. For initrd generation
please use the legacy genkernel 3.3.
.SH USAGE
Unlike previous versions of genkernel, genkernel 4.0 uses a modular
architecture and functions are performed in discrete steps. The general
syntax is:
.PP
# genkernel --flags module1:: module2::
.PP
This would run module1 and module2 as well as any dependencies
with the specified flags. Note the "::" that is appended onto
the module name.
.SH USEFUL MODULES
The following useful modules are listed here for convenience:
.PP
.I \fBall\fR
.RS
This is a metamodule which mimics the 'all' functionality of
genkernel-3.3; producing a kernel, initramfs (if needed) and
running any extra steps such as the installation and bootloader
configuration of the kernel.
.RE
.I \fBkernel\fR
.RS
Build only the kernel and the modules.
.RE
.I \fBinitramfs\fR
.RS
Build only the initramfs.
.RE
.PP
For other modules see the contents of the
.I /usr/share/genkernel\fR directory.
.SH OPTIONS
Genkernel supports the following options which alter its
behaviour. Certain options have ``\fB--no-\fR'' variants which
do the opposite thing. You can specify your options in any order.
.PP
.BR Debugging \ Options
.TP
\fB\-\-debuglevel=\fR<0-5>
This controls the out verbosity level of genkernel output - if this is set
to 0, minimal debugging is done; if this is set to 5 as much output as
possible is given.
.TP
\fB\-\-debugfile=\fR<outfile>
This outputs full debugging data; regardless of --debuglevel to the file 
<outfile>. By default this is
.I /var/log/genkernel.log\fR.
.PP
.BR Internals
.TP
\fB\-\-arch\-override=\fR<...>
Forces genkernel to compile for the selected architecture (useful for
cross-compiling).
.TP
\fB\-\-callback=\fR<...>
Run the specified arguments in the current environment after the kernel and
modules have been compiled.
.TP
\fB\-\-cachedir=\fR<...>
Override the default cache location for initrd components.
.TP
\fB\-\-tempdir=\fR<...>
Override the default location for storing temporary files.
.TP
\fB\-\-profile=\fR<...>
Import the named profile into the configuration tree.
.TP
\fB\-\-profile-dump\fR
Override the default location for storing temporary files.
.TP
\fB\-\-\fR[no\-]\fBusecolor\fR
Turns on, or off, console output in color using escape sequences.
.PP
.BR Cross \ Compiling
.TP
\fB\-\-cross\-compile=\fR<...>
Specifies the cross compiler to use for both the kernel and utilities.
.TP
\fB\-\-kernel\-cross\-compile=\fR<...>
Specifies the cross compiler to use for the kernel.
.TP
\fB\-\-utils\-cross\-compile=\fR<...>
Specifies the cross compiler to use for utilities.
.PP
.BR Kernel \ Configuration
.TP
\fB\-\-kernel\-config=\fR<file>
This specifies a kernel configuration file to use for compilation; by default
.config in the kernel source tree is used.
.TP
\fB\-\-\fR[no\-]\fBforce-config\fR
This options allows genkernel to forcefully edit the configuration file and turn
on any missing options that it deems to be mandatory -- for example, if LVM
support is requested but not enabled then genkernel would automatically turn
it on in the kernel configuration. This option is off by default.
.TP
\fB\-\-\fR[no\-]\fBmenuconfig\fR
Runs, or does not run "make menuconfig" after running "make oldconfig".
.TP
\fB\-\-\fR[no\-]\fBsave\-config\fR
Saves, or does not save the kernel configuration to
.I /etc/kernels
if the kernel is successfully compiled.
.TP
\fB\-\-\fR[no\-]\fBoldconfig\fR
Run, or do not run "make oldconfig". The default is to have the option enabled;
it is also implied if the \-\-\fBclean\fR option is enabled.
.TP
\fB\-\-\fR[no\-]\fBconfig\fR
Run "make config" to configure the kernel.
.TP
\fB\-\-\fR[no\-]\fBgconfig\fR
Run "make gconfig" to configure the kernel.
.TP
\fB\-\-\fR[no\-]\fBxconfig\fR
Run "make xconfig" to configure the kernel.
.TP
\fB\-\-\fR[no\-]\fBmrproper\fR
Runs, or does not run, "make mrproper" before compilation - this erases both
any compiled object files in the kernel source tree as well as the kernel
configuration. This option is implied if Kbuild output is used.
.TP
\fB\-\-\fR[no\-]\fBclean\fR
Runs, or does not run, "make clean" before compilation - this erases any
compiled object files in the kernel source tree but does not have an impact
on the kernel configuration.
.TP
\fB\-\-\fR[no\-]\fBinternal-initramfs\fR
This option creates a kernel with an embedded initramfs image in the kernel
image.
.TP
\fB\-\-kernel-tree=\fR<dir>
This specifies the location of the kernel sources; the default is
/usr/src/linux.
.TP
\fB\-\-kbuild-output=\fR<dir>
This enables Kbuild output and specifies the directory to use for
it.
.TP
\fB\-\-kernel-name=\fR<...>
This options tags the kernel and initramfs with a name; if not defined
this defaults to "genkernel".
.TP
\fB\-\-makeopts=\fR<makeopts>
GNU Make options such as \fB\-j2\fR, etc. \fB\-j\fRX is filtered during the
module compilation stage of 2.4 series kernels to avoid bottlenecks; the
2.6 build system does not have this issue and \fB\-j\fRX is not filtered for it.
.PP
.BR initramfs
.TP
\fB\-\-\fR[no\-]\fBgmi\fR
Disable genkernel's initramfs scripts allowing you to use an overlay
of your own.
\fB\-\-\fR[no\-]\fBbusybox\fR
Enable or disable busybox in the initramfs. By default, busybox is
included.
.TP
\fB\-\-busybox\-config=\fR<file>
Busybox configuration file to use when compiling busybox.
.TP
\fB\-\-\fR[no\-]\fBbusybox-menuconfig\fR
Run busybox's menuconfig before compiling busybox.
.TP
\fB\-\-\fR[no\-]\fBudev\fR
Enable or disable udev in the initramfs. By default, udev is
included.
.TP
\fB\-\-\fR[no\-]\fBdmraid\fR
Enable or disable dmraid in the initramfs. By default, this option
is not included. Be sure to enable the requires kenrel configuration
features to use DMRAID.
.TP
\fB\-\-\fR[no\-]\fBevms2\fR
Enable or disable EVMS2 in the initramfs. By default, this option
is not included. Be sure to enable the required kernel configuration
features to use EVMS2.
.TP
\fB\-\-\fR[no\-]\fBlvm2\fR
Enable or disable LVM2 in the initramfs. By default, this option
is not included. Be sure to enable the required kernel configuration
features to use LVM2.
.TP
\fB\-\-\fR[no\-]\fBe2fsprogs\fR
Enable or disable e2fsprogs in the initramfs. By default, this option
is not included. Enabling it includes the "blkid" application in the
initramfs.
.TP
\fB\-\-kernel-modules=\fR<...>
This option adds or subtracts from the list of included kernel modules
that are merged into the initramfs. To remove a module specify "-module",
while to add a module specify "GROUP:module" to add the module to the
specified module group.
.TP
\fB\-\-\fR[no\-]\fBkernel-modules-cpio\fR
Enable or disable kernel-modules in the initramfs, by default kernel
modules are enabled.
.TP
\fB\-\-initramfs\-overlay=\fR<dir>
Directory structure to inject into the initramfs; this option will
automatically generate a CPIO as needed from the directory.
.TP
\fB\-\-external\-cpio=\fR<cpio>
CPIO file to inject into the initramfs.
.TP
\fB\-\-linuxrc=\fR<file>
Use <file> for the linuxrc instead of the genkernel linuxrc.
.TP
\fB\-\-\fR[no\-]\fBkeymap\-auto\fR
Force keymap selection at boot.
.TP
\fB\-\-\fR[no\-]\fBgensplash\fR
Enables or disables gensplash support.
.TP
\fB\-\-gensplash-res=\fR<resolutions>
Optionally select gensplash resolutions to include.
.TP
\fB\-\-gensplash-theme=\fR<theme>
Select the gensplash theme to use if gensplash support is enabled.
.PP
.BR "all::" \ target
.TP
.TP
\fB\-\-\fR[no\-]\fBinitramfs\fR
Do not build a initramfs.
.TP
\fB\-\-\fR[no\-]\fBinstall\fR
Install or do not install the kernel/initramfs to /boot after building.
.TP
\fB\-\-install\-initramfs\-path=\fR<...>
This option specifies an installation destination for the initramfs image.
.TP
\fB\-\-install\-path=\fR<...>
This option specifies an installation destination for the initramfs image
and the kernel.
.TP
\fB\-\-install\-mod\-path=\fR<...>
This option specifies an installation destination for the kernel modules.
.TP
\fB\-\-\fR[no\-]\fBsetgrup\fR
If enabled this option modifies the grub.conf settings to reflect the
newly installed kernel and initramfs images.
\fB\-\-\fR[no\-]\fBmountboot\fR
If enabled /boot will be automatically mounted if needed to install
the kernel and initramfs images.
.SH INITRD OPTIONS
The following options can be passed as kernel parameters from the
bootloader, which the initrd scripts would recognize.
.TP
\fBreal_root=\fR<...>
Specifies the device node of the root filesystem to mount.
.TP
\fBdodmraid=\fR<...>
Passes arguments to dmraid on bootup.
.TP
\fBreal_init=\fR<...>
Passes arguments to init on bootup.
.TP
\fBscandelay\fR=<...>
Pauses for 10 seconds before running devfsd if no argument is specified;
otherwise pauses for the number of specified seconds.
.TP 
\fBip\fR=<...>
Normally used to tell the kernel that it should start a network interface. If present, the initrd will try to mount a livecd over NFS.
.TP 
\fBnfsroot\fR=<...>
If present, the initrd will try to mount a livecd from that location. Otherwise the location will be deduced from the DCHP request (option root\-path)

.SH NETBOOTING
The initrd scripts have limited support for network booting.
This is activated if the ip=<...> kernel parameter was given. Please refer to the genkernel guide at http://www.gentoo.org/doc/en/genkernel.xml for more information.

The initrd scripts will extract any *.tar.gz files found in the \fB/add\fR directory of the livecd into the root filesystem during boot. This way it is easy to extend a netbooted LiveCD i.e. add custom tools, or other kernel modules.
.SH REPORTING BUGS
If you believe you have found a bug in the genkernel scripts, then please
file a bug on the Gentoo Linux Bugzilla: 
.I http://bugs.gentoo.org\fR,
assigning your bug to genkernel@gentoo.org. We cannot assist you
with kernel compilation failures unless they are caused by a genkernel
bug.
.PP
Kernel issues for Gentoo-supported kernels, including compilation
failures should go to
.I http://bugs.gentoo.org
and should be assigned to kernel@gentoo.org. Please check if an
existing bug documents the same issue before opening a new bug. Issues
for kernel sources not supported by Gentoo should go to their relevant
authors.
.SH AUTHORS
Tim Yamin
.B <plasmaroo@gentoo.org>
.sp
Eric Edgar
.B <rocket@gentoo.org>
.sp
NFS Support by Thomas Seiler
.B <thseiler@gmail.com>
